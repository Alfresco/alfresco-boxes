{
    "builders": [
        {
            "access_key": "{{user `aws_access_key`}}",
            "ami_name": "alfresco-allinone {{timestamp}}",
            "instance_type": "m1.small",
            "region": "us-west-1",
            "secret_key": "{{user `aws_secret_key`}}",
            "source_ami": "ami-a4e81fd3",
            "ssh_username": "ubuntu",
            "type": "amazon-ebs"
        }
    ],
    "provisioners": [
        {
            "cookbook_paths": [
                "../../common/vendor-cookbooks"
            ],
            "data_bags_path": "../../common/data_bags",
            "execute_command": "echo 'vagrant' | {{if .Sudo}}sudo -S{{end}} chef-solo --no-color -c {{.ConfigPath}} -j {{.JsonPath}} -l debug",
            "install_command": "echo 'vagrant' | {{if .Sudo}}sudo -S{{end}} bash -c 'curl -L https://www.opscode.com/chef/install.sh| bash -s -- -v 11.8'",
            "json": {
                "alfresco": {
                    "version":"4.2.1",
                    "properties": {
                        "hostname.private":"192.168.1.223"
                    }
                },
                "maven": {
                  "master_password":"{your_mvn_master_password}"
                },
                "artifacts": {
                    "alfresco": {
                        "enabled": true
                    },
                    "keystore": {
                        "enabled": true
                    },
                    "alfresco-mmt": {
                        "enabled": true
                    },
                    "alfresco-spp": {
                        "enabled": true
                    },
                    "mysqlconnector": {
                        "enabled": true
                    },
                    "share": {
                        "enabled": true
                    },
                    "solr": {
                        "enabled": true
                    },
                    "solrhome": {
                        "enabled": true
                    }
                },
                "hostname": "precise-alf421",
                "ip": "192.168.1.223",
                "java": {
                    "default": true,
                    "accept_license_agreement": true,
                    "install_flavor": "oracle",
                    "jdk_version": "7",
                    "oracle": {
                        "accept_oracle_download_terms": true
                    }
                },
                "tomcat": {
                    "files_cookbook": "alfresco",
                    "base_version": 7,
                    "deploy_manager_apps": false,
                    "java_options": "-Xmx1500M -XX:MaxPermSize=256M -Djava.rmi.server.hostname=192.168.1.223 -Dsolr.solr.home=/var/lib/tomcat7/alf_data/solrhome -Dcom.sun.management.jmxremote=true -Dsun.security.ssl.allowUnsafeRenegotiation=true"
                }
            },
            "run_list": [
                "apt::default",
                "iptables::default",
                "alfresco::3rdparty",
                "alfresco::mysql_server",
                "alfresco::mysql_createdb",
                "tomcat::default",
                "tomcat::users",
                "alfresco::repo_config",
                "alfresco::share_config",
                "alfresco::solr_config",
                "artifact-deployer::default",
                "alfresco::apply_amps"
            ],
            "prevent_sudo": false,
            "skip_install": false,
            "type": "chef-solo"
        },
        {
          "type": "shell",
          "execute_command": "echo 'vagrant' | sudo -S sh '{{ .Path }}'",
          "scripts": [
            "../../common/scripts/purge-maven-folders.sh",
            "../../common/scripts/vagrant-ssh-key.sh",
            "../../common/scripts/vbox-additions.sh"
          ]
        },
        {
          "type": "shell",
          "execute_command": "echo 'vagrant' | sudo -S sh '{{ .Path }}'",
          "inline": ["../../common/scripts/static-ip.sh 192.168.1.223 192.168.1.1 255.255.255.0"]
        }
    ],
    "variables": {
        "aws_access_key": "",
        "aws_secret_key": ""
    }
}
